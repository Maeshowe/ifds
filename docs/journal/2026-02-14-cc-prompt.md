# CC Prompt: 2026-02-14 â€” Earnings Window + Roadmap + Telegram Teszt

## Kontextus
Olvasd el a journal-t: `docs/journal/2026-02-13-session-moneyflows-analysis.md`
A mai session 4 feladatot tartalmaz.

---

## Feladat 1: Earnings Exclusion Window â€” naptÃ¡ri 5 â†’ 7 nap

### ProblÃ©ma
A `_exclude_earnings()` in `src/ifds/phases/phase2_universe.py` `timedelta(days=5)` naptÃ¡ri napot hasznÃ¡l.
Ez nem elegendÅ‘: pl. CENX earnings feb 19, a pipeline feb 13-Ã¡n futott, `to_date = feb 18` â†’ CENX nem esett ki.
Config: `config.tuning["earnings_exclusion_days"]` in `src/ifds/config/defaults.py` = 5.

### MegoldÃ¡s
1. `defaults.py`: `"earnings_exclusion_days": 5` â†’ `"earnings_exclusion_days": 7`
2. Docstring frissÃ­tÃ©s `phase2_universe.py` modul-szinten: "5 calendar days" â†’ "7 calendar days"
3. Tesztek: keresni `earnings_exclusion` vagy `exclusion_days` tartalmÃº teszteket, frissÃ­teni ha 5-re hivatkoznak
4. **NE vÃ¡ltoztasd meg a logikÃ¡t** (`timedelta(days=...)`) â€” csak a config Ã©rtÃ©ket emeld 7-re

### ValidÃ¡ciÃ³
- `python -m pytest tests/ -k "earning" -v` â€” minden teszt pass
- EllenÅ‘rizd hogy a pipeline output "Earnings excluded" szÃ¡mÃ¡ban van-e vÃ¡ltozÃ¡s (valÃ³szÃ­nÅ±leg nÃ©hÃ¡ny tÃ¶bb ticker lesz kizÃ¡rva)

---

## Feladat 2: Roadmap rÃ¶gzÃ­tÃ©s â€” Trading Calendar + Freshness/WOW

FrissÃ­tsd a `docs/journal/2026-02-13-session-moneyflows-analysis.md` fÃ¡jlt, add hozzÃ¡ a "KÃ¶vetkezÅ‘ LÃ©pÃ©sek" tÃ¡blÃ¡zathoz:

| # | TanulsÃ¡g | ForrÃ¡s | IFDS akciÃ³ | Timing |
|---|---|---|---|---|
| T9 | Trading Calendar earnings exclusion | CENX bug feb 13 | `pandas_market_calendars` NYSE | BC19-20 |
| T10 | Freshness Alpha vs WOW Signals A/B | MoneyFlows WOW paper | SimEngine L2 A/B teszt | Q2 |

A T10-hez add hozzÃ¡ ezt a megjegyzÃ©st a journal-ba:
```
### T10: Freshness Alpha vs WOW Signals â€” HipotÃ©zis
A jelenlegi Freshness Alpha lineÃ¡risan bÃ¼nteti az ismÃ©tlÅ‘dÃ©st.
A MoneyFlows WOW paper szerint az ismÃ©tlÅ‘dÅ‘ magas score erÅ‘sebb jel.
HipotÃ©zis: a helyes logika U-alakÃº:
- ElsÅ‘ megjelenÃ©s (1-2 nap): BÃ“NUSZ (New Kid)
- IsmÃ©tlÅ‘dÅ‘ visszatÃ©rÃ©s (3+ nap, score magas): BÃ“NUSZ (WOW Signal)
- Folyamatos bentlÃ©t vÃ¡ltozÃ¡s nÃ©lkÃ¼l: BÃœNTETÃ‰S (stale signal)
SimEngine L2 A/B teszt szÃ¼ksÃ©ges â€” nem mÃ³dosÃ­tjuk production-ben validÃ¡ciÃ³ nÃ©lkÃ¼l.
```

---

## Feladat 3: Telegram kÃ¼ldÃ©s teszt

EgyszerÅ± Python script, NEM a pipeline-on keresztÃ¼l. CÃ©l: ellenÅ‘rizni hogy a bot token + chat_id helyes Ã©s az Ã¼zenet megÃ©rkezik.

```python
#!/usr/bin/env python3
"""Quick Telegram delivery test."""
import os
import requests

TOKEN = os.environ.get("IFDS_TELEGRAM_BOT_TOKEN", "8058925472:AAFKeC0_pc-88gG9pgZryIx4wMzMRgofkmA")
CHAT_ID = os.environ.get("IFDS_TELEGRAM_CHAT_ID", "3660205525")

# Test 1: Bot identity
r = requests.get(f"https://api.telegram.org/bot{TOKEN}/getMe", timeout=5)
print(f"Bot info: {r.json()}")

# Test 2: Send test message
msg = "ðŸ§ª IFDS Telegram Test\n\nHa ezt lÃ¡tod, a kÃ¼ldÃ©s mÅ±kÃ¶dik!\nTimestamp: " + __import__('datetime').datetime.now().isoformat()
r = requests.post(
    f"https://api.telegram.org/bot{TOKEN}/sendMessage",
    json={"chat_id": CHAT_ID, "text": msg, "parse_mode": "HTML"},
    timeout=5,
)
print(f"Send result: {r.status_code} â€” {r.json()}")
```

Mentsd el: `scripts/test_telegram.py`
Futtasd: `python scripts/test_telegram.py`

**Ha sikeres:** logold a journal-ba
**Ha "chat not found" hiba:** a user-nek elÅ‘szÃ¶r Ã¼zenetet kell kÃ¼ldenie a botnak Telegram-on, aztÃ¡n Ãºjra prÃ³bÃ¡lni.
**Ha "Unauthorized" hiba:** a token Ã©rvÃ©nytelen.

---

## Feladat 4: Commit

Egy commit az egÃ©sz:
```
fix: earnings exclusion window 5â†’7 calendar days, telegram test script

- Earnings exclusion window widened to 7 calendar days (was 5)
  to cover weekends/holidays. CENX earnings bug (2026-02-13).
- Trading calendar (pandas_market_calendars) planned for BC19-20.
- Freshness Alpha vs WOW Signals A/B test added to roadmap (Q2).
- Telegram delivery test script added.
```

---

## Display bug (emlÃ©keztetÅ‘, ha van idÅ‘)
Hardcoded "Crowded (>90)" strings in `console.py:315`, `telegram.py:205`, `market.py:363`, `phase4_stocks.py:9`.
Actual logic uses `config.core["clipping_threshold"]` = 95 correctly.
Fix: replace hardcoded strings with f-string using config value.
