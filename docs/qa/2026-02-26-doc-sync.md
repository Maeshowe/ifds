# QA Audit — Documentation Sync Check

**Date:** 2026-02-26
**Auditor:** QA Layer (CC desktop.app)
**Scope:** PARAMETERS.md, PIPELINE_LOGIC.md, CHANGELOG.md, IDEA.md, docs/planning/
**Mode:** READ-ONLY

---

## 1. PARAMETERS.md vs defaults.py

### Finding P1 — [CRITICAL] earnings_exclusion_days value mismatch

- **Document:** PARAMETERS.md, Section "Universe Building — SHORT (Zombie)"
- **What's wrong:** PARAMETERS.md states `earnings_exclusion_days = 5`. Code in `defaults.py` line 103 says `"earnings_exclusion_days": 7` with comment `# Skip if earnings within 7 calendar days`. Phase 2 module docstring also confirms "default 7".
- **Code value:** 7
- **Doc value:** 5
- **Impact:** Production-relevant parameter. Docs say 5-day exclusion but code excludes 7 days.
- **CC task:** Change PARAMETERS.md `earnings_exclusion_days` from `5` to `7`.

### Finding P2 — [MEDIUM] factor_volatility_window location mismatch

- **Document:** PARAMETERS.md, Section "CORE"
- **What's wrong:** PARAMETERS.md lists `factor_volatility_window = 20` in CORE section. In `defaults.py` this parameter is in the TUNING dict (line 288), not CORE. Creates a duplicate entry.
- **CC task:** Move `factor_volatility_window` from CORE table to TUNING, remove duplicate.

### Finding P3 — [STYLE] No missing parameters detected

All parameters in `defaults.py` CORE, TUNING, and RUNTIME dicts are represented in PARAMETERS.md. All default values match except `earnings_exclusion_days` (P1).

---

## 2. PIPELINE_LOGIC.md vs Code

### Finding PL1 — [CRITICAL] earnings_exclusion_days value mismatch

- **Document:** PIPELINE_LOGIC.md, line 274 and line 1487
- **What's wrong:** States `earnings_exclusion_days=5` in Zombie Hunter section and `kizar ha <5 napra earnings` in pipeline summary. Code uses 7.
- **CC task:** Change both occurrences from `5` to `7`.

### Finding PL2 — [MEDIUM] PIPELINE_LOGIC.md stale — 817 tests, now 848

- **Document:** PIPELINE_LOGIC.md, header lines 3 and 6
- **What's wrong:** Header says "Generalva: 2026-02-11" and "Frissitve: AGG Telegram fix utan (817 teszt)". Codebase now at 848 tests. Missing features:
  - **IBKR Connection Hardening** — not documented
  - **Telegram Phase 2 Earnings Breakdown** — `bulk_excluded_count` / `ticker_specific_excluded_count` not mentioned
  - **EARN column in Telegram exec table** — `earnings_map` / `get_next_earnings_date()` not documented
- **CC task:** Update header to "Frissitve: 2026-02-24 (848 teszt)" and add sections for above features.

### Finding PL3 — [MEDIUM] Zombie Hunter 2-pass documented but earnings_exclusion_days wrong

- **Document:** PIPELINE_LOGIC.md, lines 262-275
- **What's wrong:** 2-pass Zombie Hunter correctly documented (Pass 1 bulk + Pass 2 ticker-specific, ThreadPoolExecutor max 20), but config reference says `earnings_exclusion_days=5` when code is `7`. See PL1.

### Finding PL4 — [MEDIUM] Danger Zone filter lacks dedicated subsection

- **Document:** PIPELINE_LOGIC.md, line 848
- **What's wrong:** Danger Zone appears only as one-line entry in Phase 4 filters table. Lacks subsection explaining `_is_danger_zone()` function, the 3 signals (D/E > 5.0, net margin < -10%, IC < 1.0), and `danger_zone_min_signals=2` threshold.
- **CC task:** Add dedicated "Danger Zone Filter (BC18-prep)" subsection in Phase 4.

### Finding PL5 — [MEDIUM] Missing Telegram EARN column documentation

- **Document:** PIPELINE_LOGIC.md
- **What's wrong:** `_format_exec_table()` earnings_map parameter and EARN column (MM-DD or N/A) not documented anywhere.
- **CC task:** Add EARN column description to Telegram section (6.0d).

### Finding PL6 — [MEDIUM] Missing Telegram Phase 2 breakdown documentation

- **Document:** PIPELINE_LOGIC.md
- **What's wrong:** Phase 2 Telegram line `Earnings excluded: 12 (bulk=10, ticker-specific=2)` not documented.
- **CC task:** Add Phase 2 Telegram breakdown to Phase 2 or Telegram section.

### Finding PL7 — [STYLE] max_positions_per_sector correctly documented as 3

No action needed.

---

## 3. CHANGELOG.md

### Finding CL1 — [STYLE] CHANGELOG is comprehensive and up to date

All build cycles from BC1 through BC19 plus post-BC fixes correctly documented.

### Finding CL2 — [STYLE] Header date range should be updated

- **Document:** CHANGELOG.md, line 3
- **What's wrong:** States "2026-02-06 — 2026-02-18". Latest entries from 2026-02-24.
- **CC task:** Change end date from "2026-02-18" to "2026-02-24".

---

## 4. IDEA.md vs Current Implementation

### Finding ID1-ID5 — [MEDIUM] Intentional drift (historical spec)

IDEA.md is a Feb 4, 2026 DRAFT spec. Multiple intentional drifts:

| Parameter | IDEA.md | Code | Drift |
|-----------|---------|------|-------|
| max_positions_per_sector | 2 | 3 | Intentional (post-BC9) |
| clipping_threshold | 90 | 95 | Intentional (post-BC10) |
| earnings_exclusion_days | 5 | 7 | Intentional |
| RSI scoring | ±5 legacy | RSI Ideal Zone [45-65] | Intentional (BC9) |

**No action required on IDEA.md** — PARAMETERS.md and PIPELINE_LOGIC.md are the living docs.

---

## 5. Design Docs (docs/planning/)

| Design Doc | Status | Implementation |
|------------|--------|---------------|
| swing-hybrid-exit-design.md | APPROVED | NOT YET — planned BC20A |
| simengine-l2-design.md | APPROVED | Mode 1 DONE (BC19), Mode 2 planned BC20 |
| roadmap-2026-consolidated.md | ACTIVE | Current and accurate |

### Finding SD2 — [STYLE] simengine-l2-design.md date drift

Header says "Tervezett BC: BC19 (marcius)" but delivered in February. Optional: add "Delivered: 2026-02-18" note.

---

## 6. Cross-Document Consistency

### Finding XD1 — [CRITICAL] earnings_exclusion_days inconsistent across 3 docs

| Document | Value | Code (source of truth) |
|----------|-------|----------------------|
| defaults.py | **7** | ✅ |
| PARAMETERS.md | 5 | ❌ |
| PIPELINE_LOGIC.md | 5 | ❌ |
| IDEA.md | 5 | OK (historical) |

### Finding XD2 — [MEDIUM] console.py hardcoded fallback differs from config

- **File:** `src/ifds/output/console.py` line 449
- **What's wrong:** `max_sector = t.get("max_positions_per_sector", 2)` uses fallback 2, but config default is 3.
- **CC task:** Change fallback from `2` to `3`.

---

## Summary

| Severity | Count | Key Findings |
|----------|-------|-------------|
| **CRITICAL** | 2 | P1/PL1/XD1: `earnings_exclusion_days` 5→7 in docs (same root cause) |
| **MEDIUM** | 9 | P2, PL2-PL6, ID1-ID3, XD2 |
| **STYLE** | 5 | P3, PL7, CL1, CL2, SD2 |

## Priority Task List for CC

### Immediate (CRITICAL)
1. ☐ Fix `earnings_exclusion_days` in PARAMETERS.md: 5 → 7
2. ☐ Fix `earnings_exclusion_days` in PIPELINE_LOGIC.md: 5 → 7 (2 locations: line 274, line 1487)

### Next session (MEDIUM)
3. ☐ Move `factor_volatility_window` from CORE to TUNING in PARAMETERS.md
4. ☐ Update PIPELINE_LOGIC.md header: 817 → 848 tests, date → 2026-02-24
5. ☐ Add Danger Zone filter subsection to PIPELINE_LOGIC.md Phase 4
6. ☐ Add EARN column docs to PIPELINE_LOGIC.md Telegram section
7. ☐ Add Phase 2 breakdown (bulk/ticker-specific) to PIPELINE_LOGIC.md
8. ☐ Fix `console.py` line 449: fallback 2 → 3

### Backlog (STYLE)
9. ☐ Update CHANGELOG.md date range end: 2026-02-18 → 2026-02-24
10. ☐ Add "Delivered: 2026-02-18" to simengine-l2-design.md
